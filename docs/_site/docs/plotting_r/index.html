<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Plotting in R</title>
    <meta name="description" content="">


    <link rel="stylesheet" href="/chap/css/main.css">
    <link rel="stylesheet" href="/chap/css/font-awesome.min.css">

    <link rel="shortcut icon" href="/chap/favicon.ico?1">
    <!-- Begin Jekyll SEO tag v2.2.2 -->
<title>Plotting in R | CHAP</title>
<meta property="og:title" content="Plotting in R" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/chap/docs/plotting_r/" />
<meta property="og:url" content="http://localhost:4000/chap/docs/plotting_r/" />
<meta property="og:site_name" content="CHAP" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-02-15T21:33:50+00:00" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Plotting in R","datePublished":"2018-02-15T21:33:50+00:00","dateModified":"2018-02-15T21:33:50+00:00","url":"http://localhost:4000/chap/docs/plotting_r/"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="canonical" href="http://localhost:4000/chap/docs/plotting_r/">
    <link rel="alternate" type="application/rss+xml" title="CHAP" href="http://localhost:4000/chap/feed.xml" />
</head>


<body>

    <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container navbar-container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
            <a class="navbar-brand" href="/chap/">
                <span><img src="/chap/img/logonav.png"></span> CHAP
            </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li  class="active" ><a href="/chap/docs/home/">Documentation</a></li>
                <li ><a href="/chap/publications.html">Publications</a></li>
                <li ><a href="/chap/blog/2018/01/26/chap-at-bps/">News</a></li>
                <li ><a href="/chap/aboutus.html">About Us</a></li>
            </ul>
            <div class="navbar-right">
                <form class="navbar-form navbar-left">
                    <div class="form-group has-feedback">
                        <input id="search-box" type="text" class="form-control" placeholder="Search...">
                        <i class="fa fa-search form-control-feedback"></i>
                    </div>
                </form>
                <ul class="nav navbar-nav">
                    <li><a href=""><i class="fa fa-github" aria-hidden="true"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
</nav>



    <div class="page-content">
        <div class="wrapper">
            <div class="container">
    <div class="row">
        <div class="col-md-4">
          <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-1" aria-expanded="false" aria-controls="collapse-1">
          Getting Started
        </a>
      </h4>
    </div>
    <div id="collapse-1" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
      <ul class="list-group">
        
          
          
          <a class="list-group-item " href="/chap/docs/home/">What CHAP Can Do</a>
        
          
          
          <a class="list-group-item " href="/chap/docs/installing_chap/">Installing CHAP</a>
        
          
          
          <a class="list-group-item " href="/chap/docs/annotation_example/">Annotation Example</a>
        
      </ul>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-2" aria-expanded="false" aria-controls="collapse-2">
          Running CHAP
        </a>
      </h4>
    </div>
    <div id="collapse-2" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
      <ul class="list-group">
        
          
          
          <a class="list-group-item " href="/chap/docs/chap_workflow/">Overview of CHAP Workflow</a>
        
          
          
          <a class="list-group-item " href="/chap/docs/input_parameters/">Input Parameters</a>
        
      </ul>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-3" aria-expanded="false" aria-controls="collapse-3">
          Understanding Output
        </a>
      </h4>
    </div>
    <div id="collapse-3" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
      <ul class="list-group">
        
          
          
          <a class="list-group-item " href="/chap/docs/overview_output/">Overview of Output Files</a>
        
          
          
          <a class="list-group-item " href="/chap/docs/contents_json_file/">Contents of the JSON Output File</a>
        
          
          
          <a class="list-group-item " href="/chap/docs/contents_pdb_file/">Contents of the PDB Output File</a>
        
          
          
          <a class="list-group-item " href="/chap/docs/contents_objmtl_file/">Contents of the OBJ and MTL Output Files</a>
        
      </ul>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-4" aria-expanded="false" aria-controls="collapse-4">
          Visualising Results
        </a>
      </h4>
    </div>
    <div id="collapse-4" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
      <ul class="list-group">
        
          
          
          <a class="list-group-item " href="/chap/docs/plotting_python/">Plotting in Python</a>
        
          
          
          <a class="list-group-item active" href="/chap/docs/plotting_r/">Plotting in R</a>
        
          
          
          <a class="list-group-item " href="/chap/docs/molecular_graphics_pymol/">Molecular Graphics in PyMOL</a>
        
          
          
          <a class="list-group-item " href="/chap/docs/molecular_graphics_vmd/">Molecular Graphics in VMD</a>
        
      </ul>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-5" aria-expanded="false" aria-controls="collapse-5">
          Data Sources
        </a>
      </h4>
    </div>
    <div id="collapse-5" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
      <ul class="list-group">
        
          
          
          <a class="list-group-item " href="/chap/docs/vdw_radii/">Van der Waals Radii</a>
        
          
          
          <a class="list-group-item " href="/chap/docs/hydrophobicity_scales/">Hydrophobicity Scales</a>
        
          
          
          <a class="list-group-item " href="/chap/docs/colour_palettes/">Colour Palettes</a>
        
      </ul>
    </div>
  </div>

</div>

        </div>

        <div class="col-md-8">
            <h1>Plotting in R</h1>
            <div id="markdown-content-container">
<p>This page will walk you through loading CHAP output data into R and show you how to visualise the radius profile of the permeation pathway. It also introduces a set of turnkey scripts bundled with CHAP that you can use to quickly visualise CHAP data. These scripts are a good starting point for getting an overview of the data CHAP generates and can be adapted to suit your needs. It is assumed that you have some basic understanding of the <a href="https://www.r-project.org/about.html">R language</a> and the <a href="http://ggplot2.org/">ggplot2</a> plotting system.</p>

<h2 id="example-plotting-time-averaged-pathway-profiles">Example: Plotting Time-averaged Pathway Profiles</h2>

<p>As CHAP writes all relevant data into a single <a href="https://www.json.org/">JSON</a> file, you need to load a JSON parser first. There are several available in R; here we will use <code class="highlighter-rouge">jsonlite</code>, which can be installed by typing <code class="highlighter-rouge">install.packages("jsonlite")</code>. The <code class="highlighter-rouge">output.json</code> file from CHAP can then be loaded via</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># load JSON parser:
</span><span class="n">library</span><span class="p">(</span><span class="n">jsonlite</span><span class="p">)</span><span class="w">

</span><span class="c1"># load CHAP data:
</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fromJSON</span><span class="p">(</span><span class="n">readLines</span><span class="p">(</span><span class="s2">"output.json"</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">flatten</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>where <code class="highlighter-rouge">flatten</code> is set to <code class="highlighter-rouge">FALSE</code> to preserve the structure of the JSON data. You can now use <code class="highlighter-rouge">names(dat)</code> to get an overview of the data contained in <code class="highlighter-rouge">output.json</code>.</p>

<p>The data on the time-averaged radius profile can be found in <code class="highlighter-rouge">dat$pathwayProfile</code> and can be plotted using <code class="highlighter-rouge">ggplot</code> by typing (make sure to load <code class="highlighter-rouge">library(ggplot2)</code> first):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">plt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">pathwayProfile</span><span class="p">),</span><span class="w">
       		  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w">
              </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">radiusMean</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"s (nm)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"R (nm)"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>This will create a plot object named <code class="highlighter-rouge">plt</code>, which only contains the mean radius profile averaged over all trajectory frames, but it is very easy to add a confidence interval:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">plt</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_ribbon</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w">
                  </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">radiusMean</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">radiusSd</span><span class="p">,</span><span class="w"> 
                  </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">radiusMean</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">radiusSd</span><span class="p">),</span><span class="w"> 
              </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<p>The above will create a grey area around the mean line, which indicates the one standard deviation confidence interval.</p>

<p>In addition to the radius profile, it is interesting to also look at the residues lining the permeation pathway. A data frame for the residue data in the CHAP output can be created by typing</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">residueSummary</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>and the residue positions can be added to the radius profile via:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">plt</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res.data</span><span class="p">[</span><span class="n">res.data</span><span class="o">$</span><span class="n">poreFacing.mean</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">,],</span><span class="w">
             </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s.mean</span><span class="p">,</span><span class="w">
                 </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho.mean</span><span class="p">,</span><span class="w">
                 </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hydrophobicity</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_distiller</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BrBG"</span><span class="p">,</span><span class="w">
                         </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"H (a.u.)"</span><span class="p">,</span><span class="w">
                         </span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="o">-</span><span class="nf">max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">hydrophobicity</span><span class="p">)),</span><span class="w"> 
                                    </span><span class="nf">max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">hydrophobicity</span><span class="p">))))</span><span class="w"> 
</span></code></pre>
</div>

<p>Note that this will only plot residues that are facing the pore more than 50% of the time and that residues are coloured by their respective hydrophobicity.</p>

<p>The above commands will generate a plot that (together with some further visual tweaking) will look like the following:</p>

<p><img src="../../img/time_averaged_radius_profile_R.svg" alt="Time-averaged radius profile" title="Time-averaged radius profile" /></p>

<p>A similar procedure can be used to create plots of other pathway properties such as its hydrophobicity or the local solvent density. Take a look at <code class="highlighter-rouge">chap/scripts/plotting/R/chap_plot_pathway_profile.R</code> for an overview of what other pathway properties can be plotted.</p>

<h2 id="turnkey-plotting-scripts">Turnkey Plotting Scripts</h2>

<p>To get a quick overview of the results of a CHAP run you can use the plotting scripts available under <code class="highlighter-rouge">chap/scripts/plotting/R/</code>. There are three scripts, <code class="highlighter-rouge">chap_plot_pathway_profile.R</code>, <code class="highlighter-rouge">chap_plot_scalar_time_series.R</code>, and <code class="highlighter-rouge">chap_plot_profile_time_series.R</code>, each of which generates a set of figures that display time-averaged pathway profiles, scalar-valued time series, and vector-valued time series respectively.</p>

<p>The scripts require R to be installed and the <code class="highlighter-rouge">Rscript</code> command to be available. They also need the <code class="highlighter-rouge">optparse</code>, <code class="highlighter-rouge">jsonlite</code>, and <code class="highlighter-rouge">ggplot2</code> libraries and will install them automatically from CRAN if they are not found. The easiest way to use the scripts is to copy them into your working directory, where you can run them by simply typing</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>./chap_plot_pathway_profile.R -filename output.json -dpi 300
./chap_plot_scalar_time_series.R -filename output.json -dpi 300 
./chap_plot_profile_time_series.R -filename output.json -dpi 300
</code></pre>
</div>

<p>This will read data from <code class="highlighter-rouge">output.json</code> and create PNG figures with a resolution of 300 dots per inch. Both arguments are optional and default to <code class="highlighter-rouge">output.json</code> and <code class="highlighter-rouge">300</code> respectively. To avoid copying the scripts to your working directoy each time you generate new data, you may consider <a href="https://unix.stackexchange.com/questions/26047/how-to-correctly-add-a-path-to-path">adding the script location to your PATH</a>. Of course, you can also open and run the scripts from an R IDE such as <a href="https://www.rstudio.com/">RStudio</a>.</p>
</div>
            <p class="text-center">
              <br />
              <a target="_blank" href="/_docs/visualising-results/plotting_r.md" class="btn btn-default githubEditButton" role="button">
                <i class="fa fa-pencil fa-lg"></i> Improve this page
              </a>
            </p>
            <hr>
            





  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  
    <ul class="pager">
      
        
        
        <li class="previous">
          <a href="/chap/docs/plotting_python/">
            <span aria-hidden="true">&larr;</span> Previous
          </a>
        </li>
      

      
        
        
        <li class="next">
          <a href="/chap/docs/molecular_graphics_pymol/">
            Next <span aria-hidden="true">&rarr;</span>
          </a>
        </li>
      
    </div>
    <div class="clear"></div>
    

        </div>

    </div>
</div>

        </div>
    </div>

    <footer class="footer">
    <div class="container">

        <p class="text-center">
            CHAP 2018 |
            Powered by <a href="https://github.com/aksakalli/jekyll-doc-theme">Jekyll Doc Theme</a>
        </p>
        <!-- <p class="text-muted">Place sticky footer content here.</p> -->
    </div>
</footer>

    <script>
  var baseurl = '/chap'
</script>
<script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="/chap/js/bootstrap.min.js "></script>
<script src="/chap/js/typeahead.bundle.min.js "></script>

<script src="/chap/js/main.js "></script>

</body>

</html>
